import{o as l,c as a,w as d,v as c,a as o,t as D,n as y,u as V,r as g,b as W,d as M,e as I,F as _,f as w,g as C}from"./index-CVTFm9AL.js";import{a as h}from"./axios-C8DqakIB.js";const N="/vue-todolist/img2.png",R={id:"todo.id",class:"todoWrapper"},E={x:"0px",y:"0px",viewBox:"0 0 507.506 507.506",width:"20",height:"20",style:{"margin-right":"1rem"}},G=o("g",null,[o("path",{d:"M163.865,436.934c-14.406,0.006-28.222-5.72-38.4-15.915L9.369,304.966c-12.492-12.496-12.492-32.752,0-45.248l0,0   c12.496-12.492,32.752-12.492,45.248,0l109.248,109.248L452.889,79.942c12.496-12.492,32.752-12.492,45.248,0l0,0   c12.492,12.496,12.492,32.752,0,45.248L202.265,421.019C192.087,431.214,178.271,436.94,163.865,436.934z",fill:"#FFD370"})],-1),X=[G],A={__name:"TodoComponent",props:["todo"],emits:"deleteTodo",setup(i,{emit:m}){const f=m;return(r,n)=>(l(),a("div",R,[d((l(),a("svg",E,X,512)),[[c,i.todo.status===!0]]),d(o("button",{class:"checkbox",onClick:n[0]||(n[0]=u=>f("updateTodoStatus",i.todo.id))},null,512),[[c,i.todo.status===!1]]),o("p",{class:y({check:i.todo.status})},D(i.todo.content),3),o("button",{class:"deleteBtn",onClick:n[1]||(n[1]=u=>f("deleteTodo",i.todo.id))},"X")]))}},j=o("img",{src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"logo"},null,-1),q={class:"navWrapper"},H={id:"mainTodoWrapper"},J={class:"textInput"},K={id:"todoWrapper"},O={class:"buttonGrp"},P={class:"todoSumText"},Q={id:"noTodoUI",style:{"margin-top":"2rem",display:"flex","flex-direction":"column","align-items":"center"}},Y=o("h2",null,"目前暫無待辦事項",-1),Z=o("img",{src:N,alt:"no todo image"},null,-1),tt=[Y,Z],p="https://todolist-api.hexschool.io",st={__name:"TodoView",setup(i){const m=V(),f=document.cookie.replace(/(?:(?:^|.*;\s*)todoUser\s*=\s*([^;]*).*$)|^.*$/,"$1"),r=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),n=g("all"),u=g(""),v=g([]),S=g([]),$=g([]);function U(){S.value=v.value.filter(e=>e.status===!0),$.value=v.value.filter(e=>e.status===!1)}function z(e){var t=new Date;t.setDate(t.getDate()-1);var s=";expires="+t,F="";document.cookie=e+"="+F+s+"; path=/"}W(async()=>{const e=`${p}/users/checkout`;try{await h.get(e,{headers:{Authorization:r}}),T()}catch{alert("請先登入"),m.push("/login")}});async function B(){const e=`${p}/users/sign_out`;try{await h.post(e,{},{headers:{Authorization:r}}),z("todoToken"),z("todoUser"),alert("登出成功"),m.push("/login")}catch(t){console.log("登出失敗",t)}}function k(e){n.value=e}async function T(){const e=`${p}/todos/`;try{const t=await h.get(e,{headers:{Authorization:r}});v.value=t.data.data,U()}catch(t){console.log("拿todos失敗",t)}}async function L(){const e=`${p}/todos/`;if(u.value===""){alert("請輸入待辦事項");return}else try{await h.post(e,{content:u.value},{headers:{Authorization:r}}),alert("新增成功"),T(),u.value=""}catch(t){console.log("新增失敗",t)}}function x(e){const t=`${p}/todos/${e}`;try{h.delete(t,{headers:{Authorization:r}}),alert("待辦事項已刪除"),T()}catch(s){console.log("刪除失敗",s)}}function b(e){const t=`${p}/todos/${e}/toggle`;try{h.patch(t,null,{headers:{Authorization:r}}),alert("待辦事項狀態已更新"),T()}catch(s){console.log("toggle 失敗",s)}}return(e,t)=>(l(),a(_,null,[o("header",null,[o("nav",null,[j,o("div",q,[o("p",null,D(M(f))+"的待辦",1),o("button",{onClick:B},"登出")])])]),o("div",H,[o("div",J,[d(o("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s)},null,512),[[I,u.value]]),o("button",{onClick:L},"+")]),d(o("div",K,[o("div",O,[o("button",{class:y({btnActive:n.value==="all"}),onClick:t[1]||(t[1]=s=>k("all"))},"全部",2),o("button",{class:y({btnActive:n.value==="yet"}),onClick:t[2]||(t[2]=s=>k("yet"))}," 待完成 ",2),o("button",{class:y({btnActive:n.value==="done"}),onClick:t[3]||(t[3]=s=>k("done"))}," 已完成 ",2)]),(l(!0),a(_,null,w(v.value,s=>d((l(),a("div",{id:"todos",key:s.id},[C(A,{onUpdateTodoStatus:b,todo:s,onDeleteTodo:x},null,8,["todo"])])),[[c,n.value==="all"]])),128)),(l(!0),a(_,null,w($.value,s=>d((l(),a("div",{id:"todos",key:s.id},[C(A,{onUpdateTodoStatus:b,todo:s,onDeleteTodo:x},null,8,["todo"])])),[[c,n.value==="yet"]])),128)),(l(!0),a(_,null,w(S.value,s=>d((l(),a("div",{id:"todos",key:s.id},[C(A,{onUpdateTodoStatus:b,todo:s,onDeleteTodo:x},null,8,["todo"])])),[[c,n.value==="done"]])),128)),o("p",P,D($.value.length)+" 個待完成項目",1)],512),[[c,v.value.length>0]]),d(o("div",Q,tt,512),[[c,v.value.length===0]])])],64))}};export{st as default};
